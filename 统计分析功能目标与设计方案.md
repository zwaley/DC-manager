# 统计分析功能目标与设计方案

## 项目背景

当前系统已具备基础的设备和连接统计功能，包括：
- 设备总数统计
- 端口总数统计
- 已使用端口统计
- 空闲端口统计
- 连接数量统计

为了提升系统的数据分析能力，需要增加更深入的统计分析功能，主要包括使用率、空闲率等关键性能指标。

## 功能目标

### 1. 核心统计分析指标

#### 1.1 端口使用率分析
- **端口总体使用率**：已使用端口数 / 端口总数 × 100%
- **设备端口使用率**：按设备类型统计端口使用率
- **站点端口使用率**：按站点统计端口使用率

#### 1.2 端口空闲率分析
- **端口总体空闲率**：空闲端口数 / 端口总数 × 100%
- **设备端口空闲率**：按设备类型统计端口空闲率
- **站点端口空闲率**：按站点统计端口空闲率
- **空闲资源预警**：空闲率过低时的预警机制



#### 1.3 端口规格统计分析（暂时搁置）
- **端口规格分布**：按设备统计不同规格端口的数量分布
- **端口规格使用情况**：统计各规格端口的使用状态（总数、已使用、剩余）
- **端口类型分析**：区分熔丝端口和空开端口的统计
- **设备端口容量分析**：基于端口规格的设备容量评估

**注：该功能暂时搁置，原因如下：**
1. **数据完整性挑战**：未连接的端口缺乏规格信息，无法进行完整统计
2. **数据标准化复杂**：端口规格数据格式不统一，需要复杂的解析和标准化处理
3. **实现复杂度高**：需要从连接表中提取和分析端口规格信息，技术实现较为复杂
4. **业务价值评估**：相比现有端口使用率统计，该功能的增量价值有限

**后续实现建议：**
- 待系统端口数据结构完善后再考虑实现
- 可先实现基于现有连接数据的端口规格分布统计作为过渡方案
- 建议在设备管理模块中增加端口规格的标准化录入功能

### 2. 可视化展示目标

#### 2.1 统计分析仪表板
- **关键指标卡片**：使用率、空闲率、容量利用率等核心指标
- **分布图表**：饼图、柱状图显示各维度分布
- **热力图**：站点或设备类型的使用率热力图

#### 2.2 交互式分析功能
- **钻取分析**：从总体指标钻取到具体设备或连接
- **筛选功能**：按站点、设备类型等维度筛选
- **对比分析**：不同维度的对比
- **导出功能**：统计报表的导出功能

### 3. 预警与监控目标

#### 3.1 阈值预警
- **使用率预警**：端口使用率超过设定阈值时预警
- **空闲率预警**：空闲率过低时的资源紧张预警
- **连接异常预警**：连接数量异常变化的预警



## 技术实现方案

### 1. 后端API设计

#### 1.1 统计分析API端点
```
GET /api/analytics/utilization-rates    # 使用率统计
GET /api/analytics/idle-rates           # 空闲率统计
GET /api/analytics/summary-dashboard    # 仪表板汇总数据
```

**已移除的API端点：**
```
GET /api/analytics/capacity-analysis    # 容量分析（已删除）
```
**移除原因：** 功率容量统计功能已从系统中删除，该API端点不再需要。

#### 1.2 数据计算逻辑
- **实时计算**：基于当前数据库状态计算实时指标
- **缓存机制**：对复杂计算结果进行缓存优化

### 2. 前端界面设计

#### 2.1 统计分析页面结构
```
统计分析页面
├── 关键指标卡片区域
│   ├── 端口使用率卡片
│   └── 空闲率卡片
├── 图表分析区域
│   ├── 分布分析图表
│   └── 对比分析图表
└── 详细数据表格区域
    ├── 按设备类型统计表
    └── 按站点统计表
```

**已移除的界面元素：**
- ~~容量利用率卡片~~（已删除）
- ~~容量分析标签页~~（已删除）
- ~~容量统计表格~~（已删除）

#### 2.2 图表库选择
- **Chart.js**：用于绘制各类统计图表
- **响应式设计**：适配不同屏幕尺寸
- **交互功能**：图表的点击、缩放、筛选等交互

### 3. 数据库设计

#### 3.1 预警配置表设计
```sql
CREATE TABLE alert_thresholds (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    metric_type VARCHAR(50) NOT NULL,     -- 指标类型
    threshold_type VARCHAR(20) NOT NULL,  -- 阈值类型（上限、下限）
    threshold_value DECIMAL(10,4) NOT NULL, -- 阈值
    alert_level VARCHAR(20) NOT NULL,     -- 预警级别
    is_active BOOLEAN DEFAULT TRUE,       -- 是否启用
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 实现优先级

### 第一阶段：基础统计分析
1. **核心指标计算**：使用率、空闲率
2. **基础可视化**：关键指标卡片和简单图表
3. **API接口开发**：统计分析相关的后端接口

### 第二阶段：高级分析功能
1. **多维度分析**：按设备类型、站点等维度的深入分析
2. **交互式图表**：钻取、筛选、对比等高级功能
3. **导出功能**：支持报表导出和打印

### 第三阶段：预警与监控
1. **阈值预警系统**：自动预警机制
2. **容量规划**：基于当前使用情况的容量规划建议
3. **优化建议**：基于分析结果的系统优化建议

## 预期效果

### 1. 业务价值
- **资源优化**：通过使用率分析优化资源配置
- **容量规划**：基于当前使用情况进行容量规划
- **运维效率**：通过预警机制提升运维效率
- **决策支持**：为管理决策提供数据支撑

### 2. 用户体验
- **直观展示**：关键指标一目了然
- **深入分析**：支持多维度深入分析
- **实时监控**：实时掌握系统运行状态
- **便捷操作**：简单易用的交互界面

### 3. 技术指标
- **响应速度**：统计查询响应时间 < 2秒
- **数据准确性**：统计数据准确率 > 99.9%
- **系统稳定性**：7×24小时稳定运行
- **扩展性**：支持未来功能扩展和数据量增长

## 风险评估与应对

### 1. 技术风险
- **性能风险**：大数据量统计计算可能影响性能
  - 应对：使用缓存机制和异步计算
- **数据一致性**：实时统计与历史数据的一致性
  - 应对：建立数据校验和同步机制

### 2. 业务风险
- **需求变更**：统计指标需求可能发生变化
  - 应对：设计灵活的指标配置机制
- **用户接受度**：新功能的用户接受度
  - 应对：分阶段发布，收集用户反馈

## 总结

统计分析功能将显著提升系统的数据分析能力，为用户提供深入的业务洞察。通过分阶段实施，可以确保功能的稳定性和实用性，最终实现系统价值的最大化。